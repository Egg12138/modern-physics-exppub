# CCD Report
## 1. 线阵CCD驱动及其特性测量



## 2. 利用线阵CCD测量工件直径和角位置
### 直径测量
游标卡尺测得标准块直径为1.260cm，像素宽度902.102500，标定倍数0.001396737\
使用游标卡尺测得工件直径为0.982cm
| 测量次数  | 1     | 2     | 3     |
| --------- | ----- | ----- | ----- |
| CCD测量值 | 0.979 | 0.976 | 0.981 |
| 误差      | 0.003 | 0.006 | 0.001 |
### 转动角度测量
相机到反射镜的距离约为11.25cm
| 测量次数 | 位置1   | 位置2   | 计算角度 | 转动角度读数 |
| -------- | ------- | ------- | -------- | ------------ |
| 1        | 1866.83 | 1401.39 | 1.66     | 2            |
| 2        | 1401.39 | 729.47  | 2.395    | 2            |
| 3        | 729.47  | 274.19  | 1.63     | 2            |
误差来源：
1. 估计相机到反射镜的距离时，使用底座的中线在导轨上的标度来表示反射镜与相机的距离，实际上可能有偏差
2. 激光不一定射在反射镜转轴上，且接收阵列是平面，转动时激光从反射镜到相机的路程有偏差
3. CCD谱不稳定，实验中取出现最频繁的谱峰，会产生误差\

实验讲义中给出的计算反射镜的弧度的公式：$\frac{像素宽度*14\mu m}{反射镜到CCD相机的距离}$实际上是反射激光扫过的弧度，反射镜转过的弧度是这个弧度的一半
## 4. 面阵CCD图像采集、运算和颜色处理

### a 数据采集
![4工件首图](images/4%E5%B7%A5%E4%BB%B6%E9%A6%96%E5%9B%BE.PNG)*工件原图*\
![4_1_2row](images/4_1_2row.PNG)

可见越暗的地方灰度值越低

### b 图像运算
   ![4_2_1row](images/4_2_1row.PNG)
   ![4_2gry](images/4_2_gry.PNG)
    图片整体越暗，灰度直方图的灰度分布就越接近0
   1. 灰度线性变换:\
      顾名思义，对图片的灰度值进行线性变换
$$
f(x) = ax+b
$$
![](images/4b_%E8%B4%9F%E7%89%87.PNG)
   2. 阈值变换:\
    对选定阈值[a,b]外的灰度取0，选定阈值内的灰度取255
$$ f(x)=\left\{
\begin{aligned}
    &  0 \quad x< a ,x> b\\
& 255 \quad a\le x \le b
\end{aligned}
\right.
$$
![](images/4b_gryTR2_%E5%9C%B0%E7%90%83%E4%BA%BA.PNG)

   3. 拉伸变换:\
       将原图处在$[x_1,x_2]$区间的灰度拉伸到$[y_1,y_2]$之间
   $$ f(x)=\left\{
   \begin{aligned}
   & \frac{y_1}{x_1}x \quad x<x_1\\
   & \frac{y_2-y_1}{x_2-x_1}(x-x_1)+y1 \quad x_1\le x \le x_2\\
   & \frac{255-y_2}{255-y_1}(x-x_2)+y_2 \quad x>x_2
   \end{aligned}
   \right.
   $$
![](images/4b_s.PNG)


   4. 灰度均衡变换\
    对密集分布的灰度进行分散，提高图片的对比度
    ![](images/4b_%E5%90%9E%E5%90%9E%E5%90%90%E5%90%90%E9%94%90%E5%85%8B%E4%BA%94.PNG)
    
    利用python对前三种变换进行模拟，以下是变换函数和图片变换效果
![2022-10-14-19-11-04](images/2022-10-14-19-11-04.png)

```python
def gray_linertrans(a,b,img):#灰度线性变换
    return a*img + b

def gray_tstrans(img, _max, _min = 0):#阈值变换
    a = img>_min
    b = img<_max
    return (a*b+0)*255

def gray_stretchtrans(x1,y1,x2,y2,gray):#拉伸变换
    _gray = gray.flatten()
    for x in _gray:
        if x<x1:
            x = y1/x1*x
        if x>x2:
            x = (255-y2)/(255-y1)*(x-x2)+y2
        else:
            x = (y2-y1)/(x2-x1)*(x-x1)+y1
    return _gray.reshape(np.shape(gray))
```
### c. 颜色处理
![](images/4c%E7%BA%AF%E7%BB%BF%E5%AD%97.PNG)
![](images/4c%E7%BA%AF%E7%9C%9F%E7%9A%84%E9%A2%9C%E8%89%B2.PNG)
从图上看出，蓝色通道的图片整体更暗，灰度值更大

## 5. 利用面阵CCD测量工件二维尺寸
![](images/5%E7%90%86%E5%A1%98%E7%9A%84%E5%A4%96%E8%A7%82.PNG)
![](images/5%E6%8B%90%E9%9B%B6%E5%AE%B6%E7%9A%84%E5%8D%8A%E5%BE%84.PNG)
![](images/5%E6%8B%90%E9%9B%B6%E5%AE%B6%E7%9A%84%E8%B7%9D%E7%A6%BB.PNG)
![](images/5%E7%90%86%E5%A1%98%E7%9A%84%E5%AE%BD%E5%BA%A6.PNG)
与游标卡尺对照
| 测量量         | 圆半径  | 圆心距   | 平行线距离 |
| -------------- | ------- | -------- | ---------- |
| CCD测量值      | 2.652mm | 18.415mm | 9.448mm    |
| 游标卡尺测量值 | 2.650mm | 18.700mm | 8.968mm    |
| 误差           | 0.002mm | 0.285mm  | 0.480mm    |
## 【实验中遇到的问题】
在第二部分实验【利用线阵CCD测量工件直径和角位置】中，
实验讲义中给出的计算反射镜的弧度的公式：$\frac{像素宽度*14\mu m}{反射镜到CCD相机的距离}$实际上是反射激光扫过的弧度，反射镜转过的弧度是这个弧度的一半。